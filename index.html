<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>可配置化 ECharts 柱状图（折线图文字旋转修复）</title>
    <script src="echarts.min.js"></script>
    <style>
        #chart-container {
            margin: 20px auto;
            border: 1px solid #eee;
        }
    </style>
</head>
<body>
    <div id="chart-container"></div>

    <script type="text/javascript">
        // ===================== 核心配置参数 =====================
        const CHART_CONFIG = {
            container: {
                id: 'chart-container',
                width: '90%',
                height: '90vh',
                margin: '20px auto'
            },
            
            yAxisName: {
                enable: true,
                position: 'end',
                align: 'right',
                rotate: 0,
                style: { fontSize: 16, color: '#333' },
                gap: 30
            },

            // 双数据集：得分率(折线/平铺柱状) / 分数(堆叠柱状)
            dataSets: {
                scoreRate: {
                    yAxisText: '得分率',
                    dataList: [
                        { name: '语文', data: [(0.83*81).toFixed(2) ,(0.83*67.5).toFixed(2), (0.83*89).toFixed(2), (0.83*70).toFixed(2) ] },
                        { name: '数学', data: [(0.83*109).toFixed(2), (0.83*97).toFixed(2), (0.83*100).toFixed(2), (0.83*102).toFixed(2) ] },
                        { name: '英语', data: [(0.83*119.5).toFixed(2), (0.83*115).toFixed(2), (0.83*108.5).toFixed(2), (0.83*116).toFixed(2)] },
                        { name: '政治', data: [(1.33*58).toFixed(2), (1.33*49).toFixed(2), (1.33*47).toFixed(2), (1.33*57).toFixed(2)] },
                        { name: '历史', data: [(1.66*37).toFixed(2), (1.33*51).toFixed(2), (1.33*51).toFixed(2), (1.33*46).toFixed(2)] },
                        { name: '地理', data: [(1.66*53).toFixed(2), (1.66*54).toFixed(2), (1.66*49).toFixed(2), (1.66*48).toFixed(2)] },
                        { name: '生物', data: [(1.66*52).toFixed(2), (1.66*49).toFixed(2), (1.66*49).toFixed(2), 1.66*(54).toFixed(2)] }
                    ]
                },
                score: {
                    yAxisText: '分数(总分不同)',
                    dataList: [
                        { name: '语文', data: [81, 67.5, 89, 70] },
                        { name: '数学', data: [109, 97, 100, 102] },
                        { name: '英语', data: [119.5, 115, 108.5, 116] },
                        { name: '政治', data: [58, 49, 47, 57] },
                        { name: '历史', data: [37, 51, 51, 46] },
                        { name: '地理', data: [53, 54, 49, 48] },
                        { name: '生物', data: [52, 49, 49, 54] }

                    ]
                }
            },

            // 标签配置：拆分柱状图/折线图的旋转角度
            label: {
                show: true, 
                barRotate: 90,        // 柱状图/堆叠图：文字旋转90度
                lineRotate: 0,         // 折线图：文字水平（旋转0度）
                align: 'left', 
                verticalAlign: 'middle',
                position: 'insideBottom', 
                distance: 15, 
                fontSize: 16,
                formatter: '{c}  {name|{a}}', 
                richStyle: { name: { color: '#333', fontWeight: 'normal' } }
            },

            legend: {
                show: true,
                data: ['语文', '数学', '英语', '政治', '历史', '地理', '生物'],
                position: { left: 'center', top: 'top' },
                textStyle: { fontSize: 14, color: '#666' }
            },

            toolbox: {
                show: true, orient: 'vertical',
                position: { left: 'right', top: 'center' },
                feature: {
                    mark: { show: true },
                    dataView: { show: true, readOnly: false },
                    magicType: { show: true, type: ['line', 'bar', 'stack'] },
                    restore: { show: true },
                    saveAsImage: { show: true }
                }
            },

            tooltip: {
                trigger: 'axis', axisPointer: { type: 'shadow' },
                textStyle: { fontSize: 12 }, backgroundColor: 'rgba(50,50,50,0.8)', textColor: '#fff'
            },

            xAxis: {
                type: 'category', axisTick: { show: false }, axisLine: { show: true },
                label: { fontSize: 14, color: '#333' },
                data: ['2025.10', '2025.11', '2025.12', '2026.1'],
                axisLabel: { interval: 0 },
                boundaryGap: true
            },

            yAxis: {
                type: 'value', axisTick: { show: true }, axisLine: { show: true },
                label: { fontSize: 14, color: '#333' }, splitLine: { show: true }
            },

            seriesBase: {
                barGap: '0%',
                barCategoryGap: '20%',
                emphasis: { focus: 'series' }
            }
        };

        // ===================== 渲染逻辑 =====================
        const container = document.getElementById(CHART_CONFIG.container.id);
        container.style.width = CHART_CONFIG.container.width;
        container.style.height = CHART_CONFIG.container.height;
        const myChart = echarts.init(container);
        
        // 根据图表类型动态生成标签配置（控制文字旋转）
        function getLabelOption(chartType) {
            return {
                show: CHART_CONFIG.label.show,
                // 折线图用0度（水平），柱状/堆叠用90度
                rotate: chartType === 'line' ? CHART_CONFIG.label.lineRotate : CHART_CONFIG.label.barRotate,
                align: CHART_CONFIG.label.align,
                verticalAlign: CHART_CONFIG.label.verticalAlign,
                // 折线图调整标签位置，避免遮挡
                position: chartType === 'line' ? 'top' : CHART_CONFIG.label.position,
                distance: CHART_CONFIG.label.distance,
                fontSize: CHART_CONFIG.label.fontSize,
                formatter: CHART_CONFIG.label.formatter,
                rich: CHART_CONFIG.label.richStyle
            };
        }

        // 生成图表配置
        function getChartOption(currentType = 'bar') {
            const isStack = currentType === 'stack';
            const dataSet = isStack ? CHART_CONFIG.dataSets.score : CHART_CONFIG.dataSets.scoreRate;
            const chartType = isStack ? 'bar' : currentType;
            // 动态获取标签配置（根据类型调整旋转角度）
            const labelOption = getLabelOption(chartType);

            return {
                tooltip: {
                    ...CHART_CONFIG.tooltip,
                    axisPointer: { type: chartType === 'line' ? 'line' : 'shadow' }
                },
                legend: CHART_CONFIG.legend,
                toolbox: CHART_CONFIG.toolbox,
                xAxis: [{ ...CHART_CONFIG.xAxis }],
                yAxis: [{
                    ...CHART_CONFIG.yAxis,
                    name: CHART_CONFIG.yAxisName.enable ? dataSet.yAxisText : '',
                    nameLocation: CHART_CONFIG.yAxisName.position,
                    nameAlign: CHART_CONFIG.yAxisName.align,
                    nameRotate: CHART_CONFIG.yAxisName.rotate,
                    nameTextStyle: CHART_CONFIG.yAxisName.style,
                    nameGap: CHART_CONFIG.yAxisName.gap
                }],
                series: dataSet.dataList.map(item => ({
                    ...CHART_CONFIG.seriesBase,
                    name: item.name,
                    type: chartType,
                    data: item.data,
                    label: labelOption,
                    stack: isStack ? 'total' : undefined,
                    symbol: chartType === 'line' ? 'circle' : undefined,
                    symbolSize: chartType === 'line' ? 8 : undefined,
                    barCategoryGap: isStack ? CHART_CONFIG.seriesBase.barCategoryGap : undefined
                }))
            };
        }

        // 初始渲染
        myChart.setOption(getChartOption('bar'), true);

        // 监听类型切换
        myChart.on('magictypechanged', function (params) {
            const currentType = params.currentType;
            myChart.setOption(getChartOption(currentType), true);
            setTimeout(() => {
                myChart.resize();
            }, 5000);
        });

        // 窗口自适应
        window.addEventListener('resize', () => myChart.resize());
    </script>
</body>
</html>
